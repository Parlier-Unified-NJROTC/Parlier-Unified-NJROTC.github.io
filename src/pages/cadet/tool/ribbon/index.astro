---
import Layout from "../../../../layouts/Layout.astro";
import Boxess from "../../../../components/Ribbon.astro";
---

<Layout title="Ribbon Rack" disableHero>
    <body>
        <section class="ribbon-section">
            <div class="ribbon-container">
                <div class="section-header">
                    <h1 class="section-title">
                        <img
                            src="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/refs/heads/main/Other/Seal_of_the_Navy_Junior_Reserve_Officers_Training_Corps.svg"
                            style="width: 50px; margin: -9px;"
                        />
                        NJROTC Ribbon Rack Builder
                        <img
                            src="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/refs/heads/main/Other/Seal_of_the_Navy_Junior_Reserve_Officers_Training_Corps.svg"
                            style="width: 50px; margin: -9px;"
                        />
                    </h1>
                    <p class="section-subtitle">AD FREE RIBBON RACK BUILDER</p>
                </div>

                <div class="content-container">
                    <!-- Ribbon Selection -->
                    <div class="ribbon-selection-container">
                        <div class="ribbon-selection-header">
                            <h3 class="ribbon-selection-title">
                                Select Your Ribbons
                            </h3>
                            <p class="ribbon-selection-subtitle">
                                Click on ribbons to add them to your rack
                            </p>
                        </div>
                        <div class="ribbon-selection">
                            <Boxess
                                numberR="ribbon1"
                                namelink="Meritorious Achievement Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/meritorious_achievement_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon2"
                                namelink="Distinguished Unit Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/distinguished_unit_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon3"
                                namelink="Distinguished Cadet Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/distinguished_cadet_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon4"
                                namelink="Honor Cadet Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/honor_cadet_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon5"
                                namelink="Cadet Achievement Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/cadet_achievement_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon6"
                                namelink="Unit Achievement Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/unit_achievement_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon7"
                                namelink="Aptitude Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/aptitude_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon8"
                                namelink="Naval Science IV Outstanding Cadet Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/naval_science_iv_outstanding_cadet_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon9"
                                namelink="Naval Science III Outstanding Cadet Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/naval_science_iii_outstanding_cadet_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon10"
                                namelink="Naval Science II Outstanding Cadet Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/naval_science_ii_outstanding_cadet_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon11"
                                namelink="Naval Science I Outstanding Cadet Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/naval_science_i_outstanding_cadet_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon12"
                                namelink="Exemplary Conduct Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/exemplary_conduct_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon13"
                                namelink="Exemplary Personal Appearance Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/exemplary_personal_appearance_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon14"
                                namelink="Physical Fitness Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/physical_fitness_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon15"
                                namelink="Participation Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/participation_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon16"
                                namelink="Unit Service Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/unit_service_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon17"
                                namelink="Community Service Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/community_service_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon18"
                                namelink="Academic Award Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/academic_award_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon19"
                                namelink="Drill Team Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/drill_team_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon20"
                                namelink="Color Guard Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/color_guard_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon21"
                                namelink="STEM Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/refs/heads/main/Ribbon/stem.png"
                            />
                            <Boxess
                                numberR="ribbon22"
                                namelink="Marksmanship Team Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/refs/heads/main/Ribbon/marksmanships_eam.png"
                            />
                            <Boxess
                                numberR="ribbon23"
                                namelink="Orienteering Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/orienteering_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon24"
                                namelink="Inter Service Competition Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/inter_service_competition_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon25"
                                namelink="Recruiting Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/recruiting_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon26"
                                namelink="Basic Leadership Training Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/basic_leadership_training_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon27"
                                namelink="Sea Cruise Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/Ribbon/sea_cruise_ribbon.png"
                            />
                            <Boxess
                                numberR="ribbon28"
                                namelink="CERT Ribbon"
                                rlink="https://raw.githubusercontent.com/Parlier-NJROTC/Assets/refs/heads/main/Ribbon/cert.png"
                            />
                        </div>
                    </div>

                    <!-- Ribbon Rack Display -->
                    <div class="ribbon-rack-container">
                        <div class="ribbon-rack-header">
                            <h3 class="ribbon-rack-title">Your Ribbon Rack</h3>
                        </div>
                        <div class="ribbon-rack">
                            <!-- Ribbons will be dynamically added here -->
                        </div>
                        <div class="ribbon-actions">
                            <button
                                id="DOWNLOAD-RACK"
                                class="ribbon-download-btn"
                            >
                                <svg
                                    width="16"
                                    height="16"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path
                                        d="M12 3V16M12 16L16 12M12 16L8 12"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path
                                        d="M20 17V19C20 20.1046 19.1046 21 18 21H6C4.89543 21 4 20.1046 4 19V17"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                </svg>
                                Download Ribbon Rack
                            </button>
                        </div>
                    </div>
                </div>
            </div>

             <style>
        /* Ribbon Builder Section */
        .ribbon-section {
            padding: 6rem 2rem;
            background: #000000;
            position: relative;
            z-index: 1;
            overflow: hidden;
            font-family: "Montserrat", sans-serif;
        }

        .ribbon-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                    circle at 20% 50%,
                    rgb(2 60 113 / 40%) 0%,
                    transparent 50%
                ),
                radial-gradient(
                    circle at 80% 20%,
                    rgb(2 60 113 / 40%) 0%,
                    transparent 50%
                );
            z-index: -1;
        }

        .ribbon-container {
            max-width: 50rem;
            margin: 0 auto;
            position: relative;
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-title {
            font-family: "Montserrat", sans-serif;
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            color: #fafaf5;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            position: relative;
            display: inline-block;
        }

        .section-title::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: #e6b220;
            border-radius: 2px;
        }

        .section-subtitle {
            font-size: 1.2rem;
            color: rgba(250, 250, 245, 0.8);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Content Container */
        .content-container {
            display: flex;
            gap: 2rem;
            align-items: flex-start;
        }

        /* Ribbon Selection */
        .ribbon-selection-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(2, 60, 113, 0.7);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            flex: 3;
        }

        .ribbon-selection-header {
            padding: 2rem;
            text-align: center;
            background: rgba(2, 60, 113, 0.2);
            border-bottom: 1px solid rgba(2, 60, 113, 0.5);
        }

        .ribbon-selection-title {
            font-family: "Montserrat", sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: #fafaf5;
            margin-bottom: 0.5rem;
        }

        .ribbon-selection-subtitle {
            font-size: 1rem;
            color: rgba(250, 250, 245, 0.8);
        }

        .ribbon-selection {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            align-items: center;
            justify-items: center;
        }

        .ribbon-option {
            background: rgba(10, 10, 15, 0.6);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(2, 60, 113, 0.3);
            position: relative;
            cursor: pointer;
        }

        .ribbon-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
            border-color: rgba(230, 178, 32, 0.4);
        }

        .ribbon-image {
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: rgba(2, 60, 113, 0.1);
        }

        .ribbon-image img {
            max-height: 100%;
            max-width: 100%;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }

        .ribbon-content {
            padding: 1rem;
        }

        .ribbon-name {
            font-family: "Montserrat", sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            color: #fafaf5;
            margin-bottom: 0.8rem;
            line-height: 1.3;
            text-align: center;
        }

        .ribbon-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ribbon-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ribbon-checkbox input {
            width: 18px;
            height: 18px;
            accent-color: #e6b220;
        }

        .ribbon-checkbox label {
            font-size: 0.8rem;
            color: #fafaf5;
            cursor: pointer;
        }

        .ribbon-stars {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .ribbon-stars select {
            background: rgba(2, 60, 113, 0.3);
            color: #fafaf5;
            border: 1px solid rgba(2, 60, 113, 0.5);
            border-radius: 4px;
            padding: 0.2rem 0.4rem;
            font-size: 0.8rem;
            cursor: pointer;
        }

        /* Ribbon Rack Display */
        .ribbon-rack-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(2, 60, 113, 0.7);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            transition: all 0.4s ease;
            flex: 1;
            max-width: 350px;
            /* Fixed positioning properties */
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
        }

        .ribbon-rack-header {
            padding: 2rem;
            text-align: center;
            background: rgba(2, 60, 113, 0.2);
            border-bottom: 1px solid rgba(2, 60, 113, 0.5);
        }

        .ribbon-rack-title {
            font-family: "Montserrat", sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: #fafaf5;
            margin-bottom: 0.5rem;
        }

        .ribbon-rack {
            display: flex;
            justify-content: flex-start;
            transform: rotate(180deg);
            width: 350px;
            min-height: 200px;
            justify-content: center;
            flex-wrap: wrap;
            align-items: center;
            align-content: center;
            padding: 15px 0px;
        }

        .ribbon-rack img {
            width: 100%;
            min-width: 120px;
            transform: rotate(180deg);
        }

        .ribbon-container {
            position: relative;
        }

        .ribbon-star {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            transform: rotate(180deg);
        }

        .ribbon-actions {
            display: flex;
            justify-content: center;
            padding: 1.5rem;
            border-top: 1px solid rgba(2, 60, 113, 0.5);
        }

        .ribbon-download-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.9rem 1.8rem;
            background: transparent;
            color: #e6b220;
            border: 2px solid #e6b220;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .ribbon-download-btn:hover {
            background: #e6b220;
            color: #000000;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(230, 178, 32, 0.4);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .content-container {
                flex-direction: column;
            }
            
            .ribbon-rack-container {
                position: static;
                transform: none;
                min-width: auto;
                width: 100%;
                margin-top: 2rem;
            }

            .ribbon-section {
                padding: 4rem 1.5rem;
            }

            .section-header {
                margin-bottom: 2rem;
            }

            .section-title {
                font-size: 2.5rem;
            }

            .section-subtitle {
                font-size: 1.1rem;
                padding: 0 1rem;
            }

            .ribbon-selection {
                grid-template-columns: repeat(
                    auto-fill,
                    minmax(150px, 1fr)
                );
                padding: 1.5rem;
                gap: 1rem;
            }

            .ribbon-selection-header {
                padding: 1.5rem;
            }

            .ribbon-selection-title {
                font-size: 1.5rem;
            }

            .ribbon-rack-header {
                padding: 1.5rem;
            }

            .ribbon-rack-title {
                font-size: 1.5rem;
            }

            .ribbon-rack {
                padding: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .ribbon-section {
                padding: 3rem 1rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .ribbon-selection {
                grid-template-columns: 1fr;
            }

            .ribbon-rack {
                padding: 1rem;
            }
        }
    </style>

            <!-- DON'T TOUCH MY CODE. NO JOKE IT IS SCARY -->
            <!-- DON'T TOUCH MY CODE. NO JOKE IT IS SCARY -->
            <script
                src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
            ></script>
            <script lang="js">
                const ribbonSelection =
                    document.querySelector(".ribbon-selection");
                const ribbonRack = document.querySelector(".ribbon-rack");
                const ribbonRackContainer = document.getElementById(
                    "ribbonRackContainer",
                );
                const selectedRibbons = new Set();
                const displayOrder = [
                    "Meritorious Achievement Ribbon",
                    "Distinguished Unit Ribbon",
                    "Distinguished Cadet Ribbon",
                    "Honor Cadet Ribbon",
                    "Cadet Achievement Ribbon",
                    "Unit Achievement Ribbon",
                    "Aptitude Ribbon",
                    "Naval Science IV Outstanding Cadet Ribbon",
                    "Naval Science III Outstanding Cadet Ribbon",
                    "Naval Science II Outstanding Cadet Ribbon",
                    "Naval Science I Outstanding Cadet Ribbon",
                    "Exemplary Conduct Ribbon",
                    "Exemplary Personal Appearance Ribbon",
                    "Physical Fitness Ribbon",
                    "Participation Ribbon",
                    "Unit Service Ribbon",
                    "Community Service Ribbon",
                    "Academic Award Ribbon",
                    "Drill Team Ribbon",
                    "Color Guard Ribbon",
                    "STEM Ribbon",
                    "Marksmanship Team Ribbon",
                    "Orienteering Ribbon",
                    "Inter Service Competition Ribbon",
                    "Recruiting Ribbon",
                    "Basic Leadership Training Ribbon",
                    "Sea Cruise Ribbon",
                    "CERT Ribbon",
                ];

                // Mouse following variables
                let isFollowing = false;
                let stopFollowing = false;
                let mouseX = 0;
                let mouseY = 0;

                // Initialize mouse tracking
                document.addEventListener("mousemove", (e) => {
                    mouseX = e.clientX;
                    mouseY = e.clientY;

                    if (isFollowing && !stopFollowing) {
                        updateRackPosition();
                    }
                });

                function updateRackPosition() {
                    if (!ribbonRackContainer.classList.contains("visible"))
                        return;

                    const rackRect =
                        ribbonRackContainer.getBoundingClientRect();
                    const offsetX = 20; // Offset from cursor
                    const offsetY = 20;

                    let newX = mouseX + offsetX;
                    let newY = mouseY + offsetY;

                    // Keep within viewport bounds
                    const maxX = window.innerWidth - rackRect.width - 10;
                    const maxY = window.innerHeight - rackRect.height - 10;

                    newX = Math.max(10, Math.min(newX, maxX));
                    newY = Math.max(10, Math.min(newY, maxY));

                    ribbonRackContainer.style.left = newX + "px";
                    ribbonRackContainer.style.top = newY + "px";
                }

                function startFollowing() {
                    if (selectedRibbons.size === 0) return;

                    isFollowing = true;
                    stopFollowing = false;
                    ribbonRackContainer.classList.add("following", "visible");
                    updateRackPosition();
                }

                function stopRackFollowing() {
                    isFollowing = false;
                    stopFollowing = true;
                    ribbonRackContainer.classList.remove("following");

                    // Optionally hide the rack when stopping
                    setTimeout(() => {
                        if (!isFollowing) {
                            ribbonRackContainer.classList.remove("visible");
                        }
                    }, 1000);
                }

                // Check if mouse meets stop conditions
                function checkStopConditions() {
                    // Stop if no ribbons are selected
                    if (selectedRibbons.size === 0) {
                        stopRackFollowing();
                        return true;
                    }

                    // Stop if mouse is near the edges of the screen
                    const edgeThreshold = 50;
                    if (
                        mouseX < edgeThreshold ||
                        mouseX > window.innerWidth - edgeThreshold ||
                        mouseY < edgeThreshold ||
                        mouseY > window.innerHeight - edgeThreshold
                    ) {
                        stopRackFollowing();
                        return true;
                    }

                    return false;
                }

                document
                    .querySelectorAll("#ribbon-option")
                    .forEach((option) => {
                        option.addEventListener(
                            "click",
                            handleRibbonOptionClick,
                        );
                        const label = option.querySelector("label");
                        if (label) {
                            label.addEventListener("click", handleLabelClick);
                        }

                        const select = option.querySelector("select");
                        select.addEventListener("click", function (e) {
                            e.stopPropagation();
                        });
                    });

                ribbonSelection.addEventListener("change", function (event) {
                    const target = event.target;

                    if (target.matches('input[type="checkbox"]')) {
                        const ribbonOption = target.closest(".ribbon-option");
                        const ribbonImage = ribbonOption.querySelector("img");
                        const numberR = target.id;

                        if (target.checked) {
                            if (!selectedRibbons.has(numberR)) {
                                addRibbon(ribbonImage, ribbonOption);
                            }
                        } else {
                            removeRibbon(numberR);
                        }

                        // Start following when ribbons are selected
                        if (selectedRibbons.size > 0) {
                            startFollowing();
                        } else {
                            stopRackFollowing();
                        }
                    }

                    if (target.matches("select")) {
                        const ribbonOption = target.closest(".ribbon-option");
                        const ribbonId = ribbonOption.querySelector("input").id;
                        const starValue = target.value;
                        updateStar(ribbonId, starValue);
                    }
                });

                function addRibbon(ribbonImage, ribbonOption) {
                    const numberR = ribbonOption.querySelector("input").id;
                    const container = document.createElement("div");
                    container.className = "ribbon-container";
                    container.dataset.ribbonId = numberR;
                    container.style.height = "30px";
                    container.style.position = "relative";

                    const newRibbonImage = document.createElement("img");
                    newRibbonImage.src = ribbonImage.src;
                    newRibbonImage.alt =
                        ribbonOption.querySelector("label").textContent;
                    newRibbonImage.style = `transform: rotate(180deg);
        user-select: none;
        -webkit-user-drag: none;`;

                    const starImg = document.createElement("img");
                    starImg.className = "ribbon-star";
                    starImg.style = `position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        transform: rotate(180deg);`;

                    const select = ribbonOption.querySelector("select");
                    starImg.src = `https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/ribbon-stars/${select.value}.png`;

                    container.appendChild(newRibbonImage);
                    container.appendChild(starImg);

                    const containers = Array.from(
                        ribbonRack.querySelectorAll(".ribbon-container"),
                    );
                    containers.push(container);

                    containers.sort((a, b) => {
                        const aAlt = a.querySelector("img").alt;
                        const bAlt = b.querySelector("img").alt;
                        return (
                            displayOrder.indexOf(bAlt) -
                            displayOrder.indexOf(aAlt)
                        );
                    });

                    ribbonRack.innerHTML = "";
                    containers.forEach((c) => ribbonRack.appendChild(c));
                    selectedRibbons.add(numberR);
                }

                function removeRibbon(numberR) {
                    const container = document.querySelector(
                        `div[data-ribbon-id="${numberR}"]`,
                    );
                    if (container) {
                        container.remove();
                        selectedRibbons.delete(numberR);
                    }
                }

                function updateStar(ribbonId, starValue) {
                    const container = document.querySelector(
                        `div[data-ribbon-id="${ribbonId}"]`,
                    );
                    if (!container) return;

                    const starImg = container.querySelector(".ribbon-star");
                    starImg.src = `https://raw.githubusercontent.com/Parlier-NJROTC/Assets/main/ribbon-stars/${starValue}.png`;
                }

                function handleRibbonOptionClick(event) {
                    const checkbox = event.currentTarget.querySelector(
                        'input[type="checkbox"]',
                    );
                    if (checkbox) {
                        checkbox.click();
                    }
                }

                function handleLabelClick(event) {
                    const ribbonOption = event.target.closest("#ribbon-option");
                    if (ribbonOption) {
                        const checkbox = ribbonOption.querySelector(
                            'input[type="checkbox"]',
                        );
                        if (checkbox) {
                            checkbox.click();
                        }
                    }
                }

                // Add periodic check for stop conditions
                setInterval(() => {
                    if (isFollowing && !stopFollowing) {
                        checkStopConditions();
                    }
                }, 100);

                document
                    .getElementById("DOWNLOAD-RACK")
                    .addEventListener("click", async function () {
                        const preloadImages = Array.from(
                            document.querySelectorAll(".ribbon-container"),
                        ).flatMap((container) => {
                            const images = Array.from(
                                container.querySelectorAll("img"),
                            );
                            return images.map((img) => {
                                return new Promise((resolve, reject) => {
                                    const newImg = new Image();
                                    newImg.crossOrigin = "Anonymous";
                                    newImg.src = img.src;
                                    newImg.onload = () => resolve(true);
                                    newImg.onerror = () =>
                                        reject(
                                            `Failed to load image: ${img.src}`,
                                        );
                                });
                            });
                        });

                        try {
                            await Promise.all(preloadImages);

                            html2canvas(
                                document.querySelector(".ribbon-rack"),
                                {
                                    useCORS: true,
                                    backgroundColor: null,
                                    scale: 2,
                                    logging: true,
                                    allowTaint: false,
                                },
                            ).then((canvas) => {
                                const link = document.createElement("a");
                                link.download = "ribbon-rack.png";
                                link.href = canvas.toDataURL("image/png");
                                document.body.appendChild(link);
                                link.click();
                                document.body.removeChild(link);
                            });
                        } catch (error) {
                            console.error("Error generating image:", error);
                            alert(
                                "Error generating ribbon rack image. Please try again.",
                            );
                        }
                    });

                // Initialize the rack container position
                ribbonRackContainer.style.position = "fixed";
                ribbonRackContainer.style.left = "50%";
                ribbonRackContainer.style.top = "50%";
                ribbonRackContainer.style.transform = "translate(-50%, -50%)";
            </script>
            <!-- End of scary code -->
        </section>
    </body></Layout
>
